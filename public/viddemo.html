<html>
<body>
	<video id="video1" hidden preload autobuffer seekable>
		<source src="big-buck-bunny_trailer.webm" type="video/webm">
		<!-- <source src="/small.ogv" type="video/ogg"/> -->
	</video>

	<div id="buttonbar">
		<button id="restart" onclick="video.restart();">[]</button> 
		<button id="rew" onclick="video.skip(-1)">&lt;&lt;</button>
		<button id="play" onclick="video.play()">&gt;</button>
		<button id="fastFwd" onclick="video.skip(1)">&gt;&gt;</button>
	</div>

	<canvas id="projectionCanvas" style="border: 1px solid black;"></canvas>
	<script type="text/javascript">
		var video = (function() {
			var playing = false;
			var context, canvas, video;
			var framerate = 25;//29.914;
			var width = 320;//320
			var height = 180;//240

			function initCanvas() {
				video = document.getElementById("video1");
				canvas = document.getElementById("projectionCanvas");
				context = canvas.getContext("2d");
				canvas.width = width;
				canvas.height = height;
				video.addEventListener("seeked", paintFrame);
				//video.addEventListener("play", paintFrame, false);
				video.addEventListener("loadedmetadata", function() {
					console.log("loaded metadata");
				}, false);
			}

			function paintFrame() {
				requestAnimationFrame(function(timestamp) { 
					if (!playing) return;

					console.log(timestamp, "paintframe");
					context.drawImage(video, 0, 0, width, height);

					context.beginPath();
					context.moveTo(100, 150);
					context.lineTo(300, 50);
					context.stroke();

					video.currentTime += 1/framerate;
				});
			}

			window.onload = function() {
				initCanvas();
			};

			return {
				play: function() {
					var button = document.getElementById("play");
					if (!playing) {
						// video.play();
						video.currentTime += 1/framerate; // trigger "seeked" event
						playing = true;
						button.textContent = "||";
					} else {
						video.pause();
						playing = false;
						button.textContent = ">";
					}
				},
				restart: function() {
					video.currentTime = 0;
				},
				skip: function() {
					video.currentTime += value;
					console.log(video.currentTime);
				}
			};
		}());
	</script>
</body>
</html>
